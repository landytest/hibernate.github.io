<!DOCTYPE html> <html lang="en"> <head> <title>Getting started with Hibernate Search - Hibernate Search</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="" name="description"> <meta content="Emmanuel Bernard" name="author"> <link href="http://static.jboss.org/theme/css/bootstrap-community/2.3.1.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link href="../../../stylesheets/styles.css" media="screen" rel="stylesheet"> <!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="http://static.jboss.org/images/hibernate/favicon.ico" rel="shortcut icon"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <style>
      @media (min-width: 980px) {
        .banner { background-image: url(http://static.jboss.org/images/hibernate/hibernate-banner-1180px.png); height: 110px;  }
      }
      @media (max-width: 979px) {
        .banner { background-image: url(http://static.jboss.org/images/hibernate/hibernate-logo.png); background-repeat:no-repeat; height: 60px; }
      }
      @media (max-width: 650px) {
        .banner { width: 200px; margin: 0px auto; }
      }
    </style> <script src="http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> </head> <body> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div class="container" id="content"> <div class="dropup"> <a class="tabnav-closed" href="https://www.jboss.org" id="tab">Red Hat</a> </div> <div class="navbar navbar-inverse"> <div class="navbar-inner"> <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <div class="nav-collapse collapse"> <a class="nav pull-left" href="/"> <img src="http://static.jboss.org/hibernate/images/hibernate_logo_darkbkg_200px.png" width="160px"> </a> <ul class="nav pull-left"> <li class=""><a href="/orm/">ORM</a></li> <li class="active"><a href="/search/">Search</a></li> <li class=""><a href="/validator/">Validator</a></li> <li class=""><a href="/ogm/">OGM</a></li> <li class=""><a href="/tools/">Tools</a></li> <li class=""><a href="/others/">Others</a></li> </ul> <ul class="nav pull-right"> <li><a href="http://in.relation.to">Blog</a></li> <li><a href="../../../community">Community</a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#">Follow Us <b class="caret"></b></a> <ul class="dropdown-menu projectsocialmedia"> <li><a href="https://twitter.com/hibernate"><img src="http://static.jboss.org/theme/images/common/socialmedia_icon40_twitter.png"></a></li> <li><a href="https://plus.google.com/112681342290762837955/posts"><img src="http://static.jboss.org/theme/images/common/socialmedia_icon40_googleplus.png"></a></li> </ul> </li> </ul> </div> </div> </div> <div class="row-fluid"> <div class="span2"> <div class="project-menu"> <div class="text-center project-menu-title"> <span class="icon-stack"> <i class="icon-circle icon-stack-base icon-fixed-width"></i> <i class="icon icon-light icon-fixed-width icon-search"></i> </span> </div> <ul class="nav nav-list"> <li class=""> <a href="../.."> <i class="icon-fixed-width icon-home menu-icon"></i> About </a> </li> <li class=""> <a href="../../downloads"> <i class="icon-fixed-width icon-cloud-download menu-icon"></i> Downloads </a> </li> <li class="active"> <a href=".."> <i class="icon-fixed-width icon-book menu-icon"></i> Documentation </a> </li> <li class=""> <a href="../../support"> <i class="icon-fixed-width icon-user-md menu-icon"></i> Paid support </a> </li> <li class=""> <a href="../../faq"> <i class="icon-fixed-width icon-question menu-icon"></i> FAQ </a> </li> <li class=""> <a href="../../roadmap"> <i class="icon-fixed-width icon-road menu-icon"></i> Roadmap </a> </li> <li class=""> <a href="../../contribute"> <i class="icon-fixed-width icon-beer menu-icon"></i> Contribute </a> </li> <li class="divider"></li> <li> <a href="https://community.jboss.org/en/hibernate/search"> <i class="icon-fixed-width icon-edit menu-icon"></i> Wiki </a> </li> <li> <a href="https://hibernate.atlassian.net/browse/HSEARCH"> <i class="icon-fixed-width icon-exclamation-sign menu-icon"></i> Issues </a> </li> <li> <a href="https://forum.hibernate.org"> <i class="icon-fixed-width icon-comments menu-icon"></i> Forum </a> </li> <li> <a href="https://github.com/hibernate/hibernate-search"> <i class="icon-fixed-width icon-code menu-icon"></i> Source code </a> </li> <li> <a href="http://ci.hibernate.org/job/hibernate-search-master/"> <i class="icon-fixed-width icon-stethoscope menu-icon"></i> CI </a> </li> </ul> </div> <hr class="divider"> <div class="license text-center"> Released under the <a href="https://raw.github.com/hibernate/hibernate-search/master/lgpl.txt">LGPL v2.1</a> </div> </div> <div class="span10"> <div class="row-fluid"> <div class="visible-desktop project-title-desktop"> <div class="pull-left"> <h1>Getting started with Hibernate Search</h1> </div> </div> <div class="hidden-desktop"> <div class="project-title-phone text-center"> <div> <h1>Getting started with Hibernate Search</h1> </div> </div> </div> </div> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>Welcome to Hibernate Search. The following chapter will guide you through the initial steps required to integrate Hibernate Search into an existing Hibernate enabled application. In case you are a Hibernate new timer we recommend you start <a href="http://hibernate.org/quick-start.html">here</a>.</p> </div> </div> <div id="toc" class="toc"> <div id="toctitle">Table of Contents</div> <ul class="sectlevel1"> <li><a href="#system-requirements">System requirements</a></li> <li><a href="#using-maven">Using Maven</a></li> <li><a href="#configuration">Configuration</a></li> <li><a href="#indexing">Indexing</a></li> <li><a href="#searching">Searching</a></li> <li><a href="#introduction-to-full-text">Introduction to Full-Text</a></li> <li><a href="#what-s-next">What&#8217;s next</a></li> </ul> </div> </div> <div class="sect1"> <h2 id="system-requirements"><a class="anchor" href="#system-requirements"></a>System requirements</h2> <div class="sectionbody"> <div class="dlist"> <dl> <dt class="hdlist1">Java Runtime</dt> <dd> <p>A JDK or JRE version 6 or greater. You can download a Java Runtime for Windows/Linux/Solaris <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">here</a>. If using Java version 7 make sure you avoid builds 0 and 1: those versions contained a bug which would be triggered by Lucene. Hibernate Search 3.x was compatible with Java version 5.</p> </dd> <dt class="hdlist1">Hibernate Search</dt> <dd> <p><code>hibernate-search-4.4.0.Final.jar</code> and all runtime dependencies. You can get the jar artifacts either from the dist/lib directory of the Hibernate Search distribution or you can download them from the JBoss maven repository. More information</p> </dd> <dt class="hdlist1">Hibernate ORM</dt> <dd> <p>You will need <code>hibernate-core-4.2.6.Final.jar</code> and its transitive dependencies (either from <a href="http://sourceforge.net/projects/hibernate/files/hibernate4/4.2.6.Final/">Sourceforge</a> or the Maven central repository).</p> </dd> <dt class="hdlist1">JPA 2</dt> <dd> <p>Even though Hibernate Search can be used without needing JPA annotations the following instructions will use them for basic entity configuration (<em>@Entity, @Id, @OneToMany,&#8230;</em>). This part of the configuration could also be expressed in xml or code. Hibernate Search has its own set of annotations (<em>@Indexed, @DocumentId, @Field,&#8230;</em>) for which there exists so far no XML based alternative; if annotations aren&#8217;t suited for your project, a better option is the <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#hsearch-mapping-programmaticapi">Programmatic Mapping API</a>.</p> </dd> </dl> </div> </div> </div> <div class="sect1"> <h2 id="using-maven"><a class="anchor" href="#using-maven"></a>Using Maven</h2> <div class="sectionbody"> <div class="paragraph"> <p>The Hibernate Search artifacts can be found in Maven&#8217;s central repository but are released first in the JBoss maven repository. So it&#8217;s not a requirement but we suggest to add this repository to your global <code>settings.xml</code> file (see also <a href="https://community.jboss.org/wiki/MavenGettingStarted-Users">Maven Getting Started</a> for more details).</p> </div> <div class="paragraph"> <p>This is all you need to add to your pom.xml to get started:</p> </div> <div class="listingblock"> <div class="title">Maven artifact identifier for Hibernate Search</div> <div class="content"> <pre class="CodeRay"><code class="xml language-xml"><span style="color:#070">&lt;dependency&gt;</span>&#x000A;   <span style="color:#070">&lt;groupId&gt;</span>org.hibernate<span style="color:#070">&lt;/groupId&gt;</span>&#x000A;   <span style="color:#070">&lt;artifactId&gt;</span>hibernate-search-orm<span style="color:#070">&lt;/artifactId&gt;</span>&#x000A;   <span style="color:#070">&lt;version&gt;</span>4.4.0.Final<span style="color:#070">&lt;/version&gt;</span>&#x000A;<span style="color:#070">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="listingblock"> <div class="title">Optional Maven dependencies for Hibernate Search</div> <div class="content"> <pre class="CodeRay"><code class="xml language-xml"><span style="color:#777">&lt;!-- If using JPA (2), add: --&gt;</span>&#x000A;<span style="color:#070">&lt;dependency&gt;</span>&#x000A;   <span style="color:#070">&lt;groupId&gt;</span>org.hibernate<span style="color:#070">&lt;/groupId&gt;</span>&#x000A;   <span style="color:#070">&lt;artifactId&gt;</span>hibernate-entitymanager<span style="color:#070">&lt;/artifactId&gt;</span>&#x000A;   <span style="color:#070">&lt;version&gt;</span>4.2.6.Final<span style="color:#070">&lt;/version&gt;</span>&#x000A;<span style="color:#070">&lt;/dependency&gt;</span>&#x000A;<span style="color:#777">&lt;!-- Additional Analyzers: --&gt;</span>&#x000A;<span style="color:#070">&lt;dependency&gt;</span>&#x000A;   <span style="color:#070">&lt;groupId&gt;</span>org.hibernate<span style="color:#070">&lt;/groupId&gt;</span>&#x000A;   <span style="color:#070">&lt;artifactId&gt;</span>hibernate-search-analyzers<span style="color:#070">&lt;/artifactId&gt;</span>&#x000A;   <span style="color:#070">&lt;version&gt;</span>4.4.0.Final<span style="color:#070">&lt;/version&gt;</span>&#x000A;<span style="color:#070">&lt;/dependency&gt;</span>&#x000A;<span style="color:#777">&lt;!-- Infinispan integration: --&gt;</span>&#x000A;<span style="color:#070">&lt;dependency&gt;</span>&#x000A;   <span style="color:#070">&lt;groupId&gt;</span>org.hibernate<span style="color:#070">&lt;/groupId&gt;</span>&#x000A;   <span style="color:#070">&lt;artifactId&gt;</span>hibernate-search-infinispan<span style="color:#070">&lt;/artifactId&gt;</span>&#x000A;   <span style="color:#070">&lt;version&gt;</span>4.4.0.Final<span style="color:#070">&lt;/version&gt;</span>&#x000A;<span style="color:#070">&lt;/dependency&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>Only the <em>hibernate-search-orm</em> dependency is mandatory. Dependency <em>hibernate-entitymanager</em> is only required if you want to use Hibernate Search in conjunction with JPA.</p> </div> <div class="paragraph"> <p>To use <em>hibernate-search-infinispan</em>, adding the JBoss Maven repository is mandatory, because it contains the needed Infinispan dependencies which are currently not mirrored by Maven Central.</p> </div> </div> </div> <div class="sect1"> <h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2> <div class="sectionbody"> <div class="paragraph"> <p>Once you have added all required dependencies to your application you have to add a couple of properties to your Hibernate configuration file. If you are using Hibernate directly this can be done in <code>hibernate.properties</code> or <code>hibernate.cfg.xml</code>. If you are using Hibernate via JPA you can also add the properties to <code>persistence.xml</code>. The good news is that for standard use most properties offer a sensible default, so there isn&#8217;t much to add to get started. An example configuration could look like this:</p> </div> <div class="listingblock"> <div class="title">Basic configuration options to be added to <code>hibernate.properties</code>, <code>hibernate.cfg.xml</code> or <code>persistence.xml</code></div> <div class="content"> <pre class="CodeRay"><code class="xml language-xml">...&#x000A;<span style="color:#070">&lt;property</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">hibernate.search.default.directory_provider</span><span style="color:#710">&quot;</span></span>&#x000A;          <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">filesystem</span><span style="color:#710">&quot;</span></span><span style="color:#070">/&gt;</span>&#x000A;&#x000A;<span style="color:#070">&lt;property</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">hibernate.search.default.indexBase</span><span style="color:#710">&quot;</span></span>&#x000A;          <span style="color:#b48">value</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/var/lucene/indexes</span><span style="color:#710">&quot;</span></span><span style="color:#070">/&gt;</span>&#x000A;...</code></pre> </div> </div> <div class="paragraph"> <p>First you have to tell Hibernate Search which <code>DirectoryProvider</code> to use. This can be achieved by setting the <code>hibernate.search.default.directory_provider</code> property. Apache Lucene has the notion of a <code>Directory</code> to store the index files. Hibernate Search handles the initialization and configuration of a <code>Lucene Directory</code> instance via a <code>DirectoryProvider</code>. In this tutorial we will use a a directory provider storing the index on the file system. This will give us the ability to physically inspect the Lucene indexes created by Hibernate Search (eg via <a href="http://code.google.com/p/luke/">Luke</a>). Once you have a working configuration you can start experimenting with other directory providers (see <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#search-configuration-directory">Directory Configuration</a>). Next to the directory provider you also have to specify the default base directory for all indexes via <code>hibernate.search.default.indexBase</code>.</p> </div> <div class="paragraph"> <p>Lets assume that your application contains the Hibernate managed classes <code>example.Book</code> and <code>example.Author</code> and you want to add free text search capabilities to your application in order to search the books contained in your database.</p> </div> <div class="listingblock"> <div class="title">Example entities Book and Author before adding Hibernate Search specific annotations</div> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">example</span>;&#x000A;...&#x000A;<span style="color:#007">@Entity</span>&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">String</span> title;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">String</span> subtitle;&#x000A;&#x000A;  <span style="color:#007">@ManyToMany</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Set</span>&lt;Author&gt; authors = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a5;font-weight:bold">HashSet</span>&lt;Author&gt;();&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Date</span> publicationDate;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a5;font-weight:bold">Book</span>() {}&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">example</span>;&#x000A;...&#x000A;<span style="color:#007">@Entity</span>&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Author</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">String</span> name;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">public</span> Author() {}&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>To achieve this you have to add a few annotations to the Book and Author class. The first annotation <code>@Indexed</code> marks Book as indexable. By design Hibernate Search needs to store an untokenized id in the index to ensure index unicity for a given entity. Annotation <code>@DocumentId</code> marks the property to use for this purpose and is in most cases the same as the database primary key. The <code>@DocumentId</code> annotation is optional in the case where an @Id annotation exists.</p> </div> <div class="paragraph"> <p>Next you have to mark the fields you want to make searchable. Let&#8217;s start with <code>title</code> and <code>subtitle</code> and annotate both with <code>@Field</code>. he parameter <code>index=Index.YES</code> will ensure that the text will be indexed, while <code>analyze=Analyze.YES</code> ensures that the text will be analyzed using the default Lucene analyzer. Usually, analyzing means chunking a sentence into individual words and potentially excluding common words like <code><em>a</em></code> or <em><code>the</code></em>. We will talk more about analyzers a little later on. The third parameter we specify within <code>@Field</code>,+ store=Store.NO+, ensures that the actual data will not be stored in the index. Whether this data is stored in the index or not has nothing to do with the ability to search for it. From Lucene&#8217;s perspective it is not necessary to keep the data once the index is created. The benefit of storing it is the ability to retrieve it via projections ( see <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#projections">Projections</a>).</p> </div> <div class="paragraph"> <p>Without projections, Hibernate Search will per default execute a Lucene query in order to find the database identifiers of the entities matching the query critera and use these identifiers to retrieve managed objects from the database. The decision for or against projection has to be made on a case to case basis. The default behaviour is recommended since it returns managed objects whereas projections only return object arrays.</p> </div> <div class="paragraph"> <p>Note that <code>index=Index.YES</code>, <code>analyze=Analyze.YES</code> and <code>store=Store.NO</code> are the default values for these parameters and could be omitted.</p> </div> <div class="paragraph"> <p>After this short look under the hood let&#8217;s go back to annotating the Book class. Another annotation we have not yet discussed is <code>@DateBridge</code>. This annotation is one of the built-in field bridges in Hibernate Search. The Lucene index is purely string based. For this reason Hibernate Search must convert the data types of the indexed fields to strings and vice versa. A range of predefined bridges are provided, including the DateBridge which will convert a java.util.Date into a String with the specified resolution. For more details see <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#search-mapping-bridge">Bridges</a>.</p> </div> <div class="paragraph"> <p>This leaves us with <code>@IndexedEmbedded. +This annotation is used to index associated entities (</code>@ManyToMany+, <code>@\*ToOne</code>, <code>@Embedded</code> and <code>@ElementCollection</code>) as part of the owning entity. This is needed since a Lucene index document is a flat data structure which does not know anything about object relations. To ensure that the authors' name will be searchable you have to make sure that the names are indexed as part of the book itself. On top of <code>@IndexedEmbedded</code> you will also have to mark all fields of the associated entity you want to have included in the index with <code>@Indexed</code>. For more details see <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#search-mapping-associated">Embedded and Associated Objects</a>.</p> </div> <div class="paragraph"> <p>These settings should be sufficient for now. For more details on entity mapping refer to <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#search-mapping-entity">Mapping an Entity</a>.</p> </div> <div class="listingblock"> <div class="title">Example entities after adding Hibernate Search annotations</div> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">example</span>;&#x000A;...&#x000A;<span style="color:#007">@Entity</span>&#x000A;<span style="color:#007">@Indexed</span>&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#007">@Field</span>(index=Index.YES, analyze=Analyze.YES, store=Store.NO)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">String</span> title;&#x000A;&#x000A;  <span style="color:#007">@Field</span>(index=Index.YES, analyze=Analyze.YES, store=Store.NO)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">String</span> subtitle;&#x000A;&#x000A;  <span style="color:#007">@Field</span>(index = Index.YES, analyze=Analyze.NO, store = Store.YES)&#x000A;  <span style="color:#007">@DateBridge</span>(resolution = Resolution.DAY)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Date</span> publicationDate;&#x000A;&#x000A;  <span style="color:#007">@IndexedEmbedded</span>&#x000A;  <span style="color:#007">@ManyToMany</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Set</span>&lt;Author&gt; authors = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a5;font-weight:bold">HashSet</span>&lt;Author&gt;();&#x000A;  <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a5;font-weight:bold">Book</span>() {&#x000A;  }&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span style="color:#080;font-weight:bold">package</span> <span style="color:#707;font-weight:bold">example</span>;&#x000A;...&#x000A;<span style="color:#007">@Entity</span>&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Author</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#007">@Field</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">String</span> name;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">public</span> Author() {&#x000A;  }&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="indexing"><a class="anchor" href="#indexing"></a>Indexing</h2> <div class="sectionbody"> <div class="paragraph"> <p>Hibernate Search will transparently index every entity persisted, updated or removed through Hibernate ORM. However, you have to create an initial Lucene index for the data already present in your database. Once you have added the above properties and annotations it is time to trigger an initial batch index of your books. You can achieve this by using one of the following code snippets (see also <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#search-batchindex">Rebuilding the whole index</a>):</p> </div> <div class="listingblock"> <div class="title">Using an Hibernate Session to index data</div> <div class="content"> <pre class="CodeRay"><code class="java language-java">FullTextSession fullTextSession = Search.getFullTextSession(session);&#x000A;fullTextSession.createIndexer().startAndWait();</code></pre> </div> </div> <div class="listingblock"> <div class="title">Using an EntityManager (JPA) to index data</div> <div class="content"> <pre class="CodeRay"><code class="java language-java">EntityManager em = entityManagerFactory.createEntityManager();&#x000A;FullTextEntityManager fullTextEntityManager = Search.getFullTextEntityManager(em);&#x000A;fullTextEntityManager.createIndexer().startAndWait();</code></pre> </div> </div> <div class="paragraph"> <p>After executing the above code, you should be able to see a Lucene index under <code>/var/lucene/indexes/example.Book</code>. Go ahead an inspect this index with <a href="http://code.google.com/p/luke/">Luke</a>. It will help you to understand how Hibernate Search works: Luke allows you to inspect the index shape, similarly to how you would use a SQL console to inspect the working of Hibernate ORM on relational databases.</p> </div> </div> </div> <div class="sect1"> <h2 id="searching"><a class="anchor" href="#searching"></a>Searching</h2> <div class="sectionbody"> <div class="paragraph"> <p>Now it is time to execute a first search. The general approach is to create a Lucene query, either via the Lucene API (see <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#search-query-lucene-api">Building a Lucene query using the Lucene API</a>) or via the Hibernate Search query DSL (<a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#search-query-querydsl">Building a Lucene query with the Hibernate Search query DSL</a>), and then wrap this query into a <code>org.hibernate.Query</code> in order to get all the functionality one is used to from the Hibernate API. The following code will prepare a query against the indexed fields, execute it and return a list of Books.</p> </div> <div class="listingblock"> <div class="title">Using Hibernate Session to create and execute a search</div> <div class="content"> <pre class="CodeRay"><code class="java language-java">FullTextSession fullTextSession = Search.getFullTextSession(session);&#x000A;Transaction tx = fullTextSession.beginTransaction();&#x000A;&#x000A;<span style="color:#777">// create native Lucene query unsing the query DSL</span>&#x000A;<span style="color:#777">// alternatively you can write the Lucene query using the Lucene query parser</span>&#x000A;<span style="color:#777">// or the Lucene programmatic API. The Hibernate Search DSL is recommended though</span>&#x000A;QueryBuilder qb = fullTextSession.getSearchFactory()&#x000A;    .buildQueryBuilder().forEntity(<span style="color:#0a5;font-weight:bold">Book</span>.class).get();&#x000A;org.apache.lucene.search.Query query = qb&#x000A;  .keyword()&#x000A;  .onFields(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">title</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subtitle</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">authors.name</span><span style="color:#710">&quot;</span></span>)&#x000A;  .matching(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Java rocks!</span><span style="color:#710">&quot;</span></span>)&#x000A;  .createQuery();&#x000A;&#x000A;<span style="color:#777">// wrap Lucene query in a org.hibernate.Query</span>&#x000A;org.hibernate.Query hibQuery =&#x000A;    fullTextSession.createFullTextQuery(query, <span style="color:#0a5;font-weight:bold">Book</span>.class);&#x000A;&#x000A;<span style="color:#777">// execute search</span>&#x000A;<span style="color:#0a5;font-weight:bold">List</span> result = hibQuery.list();&#x000A;&#x000A;tx.commit();&#x000A;session.close();</code></pre> </div> </div> <div class="listingblock"> <div class="title">Using JPA to create and execute a search</div> <div class="content"> <pre class="CodeRay"><code class="java language-java">EntityManager em = entityManagerFactory.createEntityManager();&#x000A;FullTextEntityManager fullTextEntityManager =&#x000A;    org.hibernate.search.jpa.Search.getFullTextEntityManager(em);&#x000A;em.getTransaction().begin();&#x000A;&#x000A;<span style="color:#777">// create native Lucene query unsing the query DSL</span>&#x000A;<span style="color:#777">// alternatively you can write the Lucene query using the Lucene query parser</span>&#x000A;<span style="color:#777">// or the Lucene programmatic API. The Hibernate Search DSL is recommended though</span>&#x000A;QueryBuilder qb = fullTextEntityManager.getSearchFactory()&#x000A;    .buildQueryBuilder().forEntity(<span style="color:#0a5;font-weight:bold">Book</span>.class).get();&#x000A;org.apache.lucene.search.Query query = qb&#x000A;  .keyword()&#x000A;  .onFields(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">title</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">subtitle</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">authors.name</span><span style="color:#710">&quot;</span></span>)&#x000A;  .matching(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Java rocks!</span><span style="color:#710">&quot;</span></span>)&#x000A;  .createQuery();&#x000A;&#x000A;<span style="color:#777">// wrap Lucene query in a javax.persistence.Query</span>&#x000A;javax.persistence.Query persistenceQuery =&#x000A;    fullTextEntityManager.createFullTextQuery(query, <span style="color:#0a5;font-weight:bold">Book</span>.class);&#x000A;&#x000A;<span style="color:#777">// execute search</span>&#x000A;<span style="color:#0a5;font-weight:bold">List</span> result = persistenceQuery.getResultList();&#x000A;&#x000A;em.getTransaction().commit();&#x000A;em.close();</code></pre> </div> </div> </div> </div> <div class="sect1"> <h2 id="introduction-to-full-text"><a class="anchor" href="#introduction-to-full-text"></a>Introduction to Full-Text</h2> <div class="sectionbody"> <div class="paragraph"> <p>Let&#8217;s make things a little more interesting now. Assume that one of your indexed book entities has the title "Refactoring: Improving the Design of Existing Code" and you want to get hits for all of the following queries: "refactor", "refactors", "refactored" and "refactoring". In Lucene this can be achieved by choosing an <em>Analyzer</em> class which applies word stemming during the indexing and during the search process. Hibernate Search offers several ways to configure the analyzer to be used (see <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#analyzer">Default analyzer and analyzer by class</a>):</p> </div> <div class="ulist"> <ul> <li> <p>Setting the <code>hibernate.search.analyzer</code> property in the configuration file. The specified class will then be the default analyzer.</p> </li> <li> <p>Setting the <code>@Analyzer</code> annotation at the entity level.</p> </li> <li> <p>Setting the <code>@Analyzer</code> annotation at the field level.</p> </li> </ul> </div> <div class="paragraph"> <p>When using the <code>@Analyzer</code> annotation one can either specify the fully qualified classname of the analyzer to use or one can refer to an analyzer definition defined by the <code>@AnalyzerDef</code> annotation. In the latter case the Solr analyzer framework with its factories approach is utilized. To find out more about the factory classes available you can either browse the Solr JavaDoc or read the corresponding section on the <a href="http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters">Solr Wiki.</a></p> </div> <div class="paragraph"> <p>In the example below a StandardTokenizerFactory is used followed by two filter factories, LowerCaseFilterFactory and SnowballPorterFilterFactory. The standard tokenizer splits words at punctuation characters and hyphens while keeping email addresses and internet hostnames intact. It is a good general purpose tokenizer. The lowercase filter lowercases the letters in each token whereas the snowball filter finally applies language specific stemming.</p> </div> <div class="paragraph"> <p>Generally, when using the Solr framework you start with a Tokenizer followed by an arbitrary number of filters.</p> </div> <div class="listingblock"> <div class="title">Using <code>@AnalyzerDef</code> and the Solr framework to define and use an analyzer</div> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span style="color:#007">@Entity</span>&#x000A;<span style="color:#007">@Indexed</span>&#x000A;<span style="color:#007">@AnalyzerDef</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customanalyzer</span><span style="color:#710">&quot;</span></span>,&#x000A;  tokenizer = <span style="color:#007">@TokenizerDef</span>(factory = StandardTokenizerFactory.class),&#x000A;  filters = {&#x000A;    <span style="color:#007">@TokenFilterDef</span>(factory = LowerCaseFilterFactory.class),&#x000A;    <span style="color:#007">@TokenFilterDef</span>(factory = SnowballPorterFilterFactory.class, params = {&#x000A;      <span style="color:#007">@Parameter</span>(name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">language</span><span style="color:#710">&quot;</span></span>, value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">English</span><span style="color:#710">&quot;</span></span>)&#x000A;    })&#x000A;  })&#x000A;<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Book</span> {&#x000A;&#x000A;  <span style="color:#007">@Id</span>&#x000A;  <span style="color:#007">@GeneratedValue</span>&#x000A;  <span style="color:#007">@DocumentId</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Integer</span> id;&#x000A;&#x000A;  <span style="color:#007">@Field</span>&#x000A;  <span style="color:#007">@Analyzer</span>(definition = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customanalyzer</span><span style="color:#710">&quot;</span></span>)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">String</span> title;&#x000A;&#x000A;  <span style="color:#007">@Field</span>&#x000A;  <span style="color:#007">@Analyzer</span>(definition = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">customanalyzer</span><span style="color:#710">&quot;</span></span>)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">String</span> subtitle;&#x000A;&#x000A;  <span style="color:#007">@IndexedEmbedded</span>&#x000A;  <span style="color:#007">@ManyToMany</span>&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Set</span>&lt;Author&gt; authors = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a5;font-weight:bold">HashSet</span>&lt;Author&gt;();&#x000A;&#x000A;  <span style="color:#007">@Field</span>(index = Index.YES, analyze = Analyze.NO, store = Store.YES)&#x000A;  <span style="color:#007">@DateBridge</span>(resolution = Resolution.DAY)&#x000A;  <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a5;font-weight:bold">Date</span> publicationDate;&#x000A;&#x000A;  <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a5;font-weight:bold">Book</span>() {&#x000A;  }&#x000A;&#x000A;  <span style="color:#777">// standard getters/setters follow here</span>&#x000A;  ...&#x000A;}</code></pre> </div> </div> <div class="paragraph"> <p>Using <code>@AnalyzerDef</code> only defines an Analyzer, you still have to apply it to entities and or properties using <code>@Analyzer</code>. Like in the above example the <code>customanalyzer</code> is defined but not applied on the entity: it&#8217;s applied on the <code>title</code> and <code>subtitle</code> properties only.</p> </div> <div class="paragraph"> <p>An analyzer definition is global, so you can define it on any entity and reuse the definition on other entities.</p> </div> </div> </div> <div class="sect1"> <h2 id="what-s-next"><a class="anchor" href="#what-s-next"></a>What&#8217;s next</h2> <div class="sectionbody"> <div class="paragraph"> <p>The above paragraphs gave you an introduction to Hibernate Search. The next step after this tutorial is to get more familiar with the overall architecture of Hibernate Search (<a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#search-architecture">Architecture</a>) and explore the basic features in more detail. Two topics which were only briefly touched in this tutorial were Analyzer configuration (<a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#analyzer">Default analyzer and analyzer by class</a>) and field bridges (<a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#search-mapping-bridge">Bridges</a>). Both are important features required for more fine-grained indexing. More advanced topics cover clustering (<a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#jms-backend">JMS Master/Slave back end</a>, <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#infinispan-directories">Infinispan Directory configuration</a>) and large index handling (<a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html_single/#advanced-features-sharding">Sharding Indexes</a>).</p> </div> </div> </div> </div> </div> </div> <footer class="container"> <div class="row-fluid"> <div class="span3 offset2"> <h4>Projects</h4> <ul> <li> <a href="../../../orm" title="Hibernate ORM">Hibernate ORM</a> </li> <li> <a href="../.." title="Search">Hibernate Search</a> </li> <li> <a href="../../../validator" title="Hibernate Validator">Hibernate Validator</a> </li> <li> <a href="../../../ogm" title="Hibernate OGM">Hibernate OGM</a> </li> <li> <a href="../../../tools" title="Hibernate Tools">Hibernate Tools</a> </li> <li> <a href="../../../others" title="Other projects">Other projects</a> </li> </ul> </div> <div class="span3"> <h4>Follow Us</h4> <ul> <li> <a href="http://in.relation.to" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/hibernate/" title="Twitter">Twitter</a> </li> <li> <a href="https://plus.google.com/112681342290762837955/posts" title="Google+">Google+</a> </li> </ul> </div> <div class="span3"> <h4>Contribute and community</h4> <ul> <li> <a href="../../../community" title="Community resources">Community resources</a> </li> <li> <a href="https://hibernate.atlassian.net" title="Submit a bug">Submit a bug</a> </li> </ul> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="row-fluid"> <div class="span6 redhatlogo text-center"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> <div class="span6 redhatlogo text-center"> <div id="logospacer"></div> <a href="http://www.jboss.org/"> <img src="../../../cache/static.jboss.org/theme/images/common/jbossbadge.png"> </a> </div> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="http://static.jboss.org/theme/js/libs/bootstrap-community/2.3.1.2/bootstrap-community.min.js"></script> <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount','UA-45270411-1']);
    _gaq.push(['_trackPageview']);
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script> </body> </html>