<!DOCTYPE html> <html lang="en"> <head> <title>Hibernate Search FAQ - Hibernate Search</title> <meta charset="utf-8"> <meta content="width=device-width, initial-scale=1.0" name="viewport"> <meta content="" name="description"> <meta content="Emmanuel Bernard" name="author"> <link href="http://static.jboss.org/theme/css/bootstrap-community/2.3.1.2/bootstrap-community.min.css" media="screen" rel="stylesheet"> <link href="../../stylesheets/styles.css" media="screen" rel="stylesheet"> <!--[if lt IE 9]><script src="http://static.jboss.org/theme/js/libs/html5/pre3.6/html5.min.js"></script><![endif]--> <link href="http://static.jboss.org/images/hibernate/favicon.ico" rel="shortcut icon"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-144x144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-114x114-precomposed.png" rel="apple-touch-icon-precomposed" sizes="114x114"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-72x72-precomposed.png" rel="apple-touch-icon-precomposed" sizes="72x72"> <link href="http://static.jboss.org/images/hibernate/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed"> <style>
      @media (min-width: 980px) {
        .banner { background-image: url(http://static.jboss.org/images/hibernate/hibernate-banner-1180px.png); height: 110px;  }
      }
      @media (max-width: 979px) {
        .banner { background-image: url(http://static.jboss.org/images/hibernate/hibernate-logo.png); background-repeat:no-repeat; height: 60px; }
      }
      @media (max-width: 650px) {
        .banner { width: 200px; margin: 0px auto; }
      }
    </style> <script src="http://static.jboss.org/theme/js/libs/jquery/jquery-1.9.1.min.js"></script> </head> <body> <ul class="visuallyhidden" id="top"> <li> <a accesskey="n" href="#nav" title="Skip to navigation">Skip to navigation</a> </li> <li> <a accesskey="c" href="#page" title="Skip to content">Skip to content</a> </li> </ul> <div class="container" id="content"> <div class="dropup"> <a class="tabnav-closed" href="https://www.jboss.org" id="tab">Red Hat</a> </div> <div class="navbar navbar-inverse"> <div class="navbar-inner"> <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <div class="nav-collapse collapse"> <a class="nav pull-left" href="/"> <img src="http://static.jboss.org/hibernate/images/hibernate_logo_darkbkg_200px.png" width="160px"> </a> <ul class="nav pull-left"> <li class=""><a href="/orm/">ORM</a></li> <li class="active"><a href="/search/">Search</a></li> <li class=""><a href="/validator/">Validator</a></li> <li class=""><a href="/ogm/">OGM</a></li> <li class=""><a href="/tools/">Tools</a></li> <li class=""><a href="/others/">Others</a></li> </ul> <ul class="nav pull-right"> <li><a href="http://in.relation.to">Blog</a></li> <li><a href="../../community">Community</a></li> <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" href="#">Follow Us <b class="caret"></b></a> <ul class="dropdown-menu projectsocialmedia"> <li><a href="https://twitter.com/hibernate"><img src="http://static.jboss.org/theme/images/common/socialmedia_icon40_twitter.png"></a></li> <li><a href="https://plus.google.com/112681342290762837955/posts"><img src="http://static.jboss.org/theme/images/common/socialmedia_icon40_googleplus.png"></a></li> </ul> </li> </ul> </div> </div> </div> <div class="row-fluid"> <div class="span2"> <div class="project-menu"> <div class="text-center project-menu-title"> <span class="icon-stack"> <i class="icon-circle icon-stack-base icon-fixed-width"></i> <i class="icon icon-light icon-fixed-width icon-search"></i> </span> </div> <ul class="nav nav-list"> <li class=""> <a href=".."> <i class="icon-fixed-width icon-home menu-icon"></i> About </a> </li> <li class=""> <a href="../downloads"> <i class="icon-fixed-width icon-cloud-download menu-icon"></i> Downloads </a> </li> <li class=""> <a href="../documentation"> <i class="icon-fixed-width icon-book menu-icon"></i> Documentation </a> </li> <li class=""> <a href="../support"> <i class="icon-fixed-width icon-user-md menu-icon"></i> Paid support </a> </li> <li class="active"> <a href="."> <i class="icon-fixed-width icon-question menu-icon"></i> FAQ </a> </li> <li class=""> <a href="../roadmap"> <i class="icon-fixed-width icon-road menu-icon"></i> Roadmap </a> </li> <li class=""> <a href="../contribute"> <i class="icon-fixed-width icon-beer menu-icon"></i> Contribute </a> </li> <li class="divider"></li> <li> <a href="https://community.jboss.org/en/hibernate/search"> <i class="icon-fixed-width icon-edit menu-icon"></i> Wiki </a> </li> <li> <a href="https://hibernate.atlassian.net/browse/HSEARCH"> <i class="icon-fixed-width icon-exclamation-sign menu-icon"></i> Issues </a> </li> <li> <a href="https://forum.hibernate.org"> <i class="icon-fixed-width icon-comments menu-icon"></i> Forum </a> </li> <li> <a href="https://github.com/hibernate/hibernate-search"> <i class="icon-fixed-width icon-code menu-icon"></i> Source code </a> </li> <li> <a href="http://ci.hibernate.org/job/hibernate-search-master/"> <i class="icon-fixed-width icon-stethoscope menu-icon"></i> CI </a> </li> </ul> </div> <hr class="divider"> <div class="license text-center"> Released under the <a href="https://raw.github.com/hibernate/hibernate-search/master/lgpl.txt">LGPL v2.1</a> </div> </div> <div class="span10"> <div class="row-fluid"> <div class="visible-desktop project-title-desktop"> <div class="pull-left"> <h1>Hibernate Search FAQ</h1> </div> </div> <div class="hidden-desktop"> <div class="project-title-phone text-center"> <div> <h1>Hibernate Search FAQ</h1> </div> </div> </div> </div> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>You&#8217;ve got a question burning you? We might have the answer for you.</p> </div> </div> <div id="toc" class="toc"> <div id="toctitle">Questions</div> <ul class="sectlevel1"> <li><a href="#indexes">Indexes</a></li> <li> <ul class="sectlevel2"> <li><a href="#no-file-created-in-index-directory">No file created in index directory</a></li> </ul> </li> <li><a href="#queries">Queries</a></li> <li> <ul class="sectlevel2"> <li><a href="#can-i-mix-hql-and-lucene-queries">Can I mix HQL and Lucene queries?</a></li> <li><a href="#avoid-two-queries-when-retrieving-results-and-size">Avoid two queries when retrieving results and size</a></li> </ul> </li> <li><a href="#configuration">Configuration</a></li> <li> <ul class="sectlevel2"> <li><a href="#i-get-an-error-message-saying-event-listeners-are-not-configured">I get an error message saying Event listeners are not configured</a></li> <li><a href="#how-do-i-get-started-with-the-search-archetype">How do I get started with the search archetype?</a></li> </ul> </li> <li><a href="#integration">Integration</a></li> <li> <ul class="sectlevel2"> <li><a href="#code-nosuchmethoderror-code-in-jboss-as-4-2"><code>NoSuchMethodError</code> in JBoss AS 4.2</a></li> <li><a href="#i-am-using-spring-and-the-index-is-not-being-updated-at-transaction-commit">I am using Spring and the index is not being updated at transaction commit</a></li> <li><a href="#how-do-i-properly-shutdown-search">How do I properly shutdown Search?</a></li> </ul> </li> </ul> </div> </div> <div class="sect1"> <h2 id="indexes"><a class="anchor" href="#indexes"></a>Indexes</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="no-file-created-in-index-directory"><a class="anchor" href="#no-file-created-in-index-directory"></a>No file created in index directory</h3> <div class="paragraph"> <p>Hibernate Search won&#8217;t create a new index in existing directories.</p> </div> <div class="paragraph"> <p>The fundamental Lucene index files are created at framework startup, but existing directories are not modified. Delete the directory: the framework will create it and build the basic index structure at startup. Since 3.1 it detects indexes in existing directories automatically.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="queries"><a class="anchor" href="#queries"></a>Queries</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="can-i-mix-hql-and-lucene-queries"><a class="anchor" href="#can-i-mix-hql-and-lucene-queries"></a>Can I mix HQL and Lucene queries?</h3> <div class="paragraph"> <p>This is not possible as there is no way to intersect the results from both queries without iterating on at least one of the results. You may consider adding additional fields to the Lucene index and then look at the Filters in the reference documentation.</p> </div> </div> <div class="sect2"> <h3 id="avoid-two-queries-when-retrieving-results-and-size"><a class="anchor" href="#avoid-two-queries-when-retrieving-results-and-size"></a>Avoid two queries when retrieving results and size</h3> <div class="paragraph"> <p>If you plan to return the number of matching results and the list of results, you should call the methods in the following order</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">fullTextQuery.list(); <span style="color:#777">//or iterate or scroll</span>&#x000A;fullTextQuery.getResultSize();</code></pre> </div> </div> <div class="paragraph"> <p>This will execute a single Lucene query instead of two and will be faster.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="configuration"><a class="anchor" href="#configuration"></a>Configuration</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="i-get-an-error-message-saying-event-listeners-are-not-configured"><a class="anchor" href="#i-get-an-error-message-saying-event-listeners-are-not-configured"></a>I get an error message saying Event listeners are not configured</h3> <div class="paragraph"> <p>The full error message looks something like this:</p> </div> <div class="listingblock"> <div class="content"> <pre>Caused by: org.hibernate.HibernateException: Hibernate Search Event listeners not configured, please check the reference documentation and the application's hibernate.cfg.xml&#x000A;   at org.hibernate.search.util.ContextHelper.getSearchFactoryBySFI(ContextHelper.java:32)</pre> </div> </div> <div class="paragraph"> <p>There are several possibilities for this error.</p> </div> <div class="ulist"> <ul> <li> <p>You are not using Hibernate Annotations in which case the event listeners have to be manually configured (see also the event listener configuration in the online documentation):</p> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="xml language-xml"><span style="color:#070">&lt;hibernate-configuration&gt;</span>&#x000A;     <span style="color:#070">&lt;session-factory&gt;</span>&#x000A;        <span style="color:#070">&lt;event</span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">post-update</span><span style="color:#710">&quot;</span></span><span style="color:#070">/&gt;</span>&#x000A;            <span style="color:#070">&lt;listener</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.hibernate.search.event.FullTextIndexEventListener</span><span style="color:#710">&quot;</span></span><span style="color:#070">/&gt;</span>&#x000A;        <span style="color:#070">&lt;/event&gt;</span>&#x000A;        <span style="color:#070">&lt;event</span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">post-insert</span><span style="color:#710">&quot;</span></span><span style="color:#070">/&gt;</span>&#x000A;            <span style="color:#070">&lt;listener</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.hibernate.search.event.FullTextIndexEventListener</span><span style="color:#710">&quot;</span></span><span style="color:#070">/&gt;</span>&#x000A;        <span style="color:#070">&lt;/event&gt;</span>&#x000A;        <span style="color:#070">&lt;event</span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">post-delete</span><span style="color:#710">&quot;</span></span><span style="color:#070">/&gt;</span>&#x000A;            <span style="color:#070">&lt;listener</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.hibernate.search.event.FullTextIndexEventListener</span><span style="color:#710">&quot;</span></span><span style="color:#070">/&gt;</span>&#x000A;        <span style="color:#070">&lt;/event&gt;</span>&#x000A;    <span style="color:#070">&lt;/session-factory&gt;</span>&#x000A;<span style="color:#070">&lt;/hibernate-configuration&gt;</span></code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="icon-tip" title="Tip"></i> </td> <td class="content"> Other versions require more event listeners, and latest versions don&#8217;t require any at all: please refer to the documentation relevant to the version you are using. </td> </tr> </table> </div> </li> <li> <p>Your are using the wrong version of Hibernate Annotation/Search.</p> <div class="paragraph"> <p>Hibernate Annotation tries to detect Search at startup and configures the event listeners in case they are found. This however requires that you have the right versions of the dependencies. Check the Compatibility Matrix for the right combination of jar files. In case you are using the jar files which ship with the Hibernate Search distribution make sure that you really installed the right jar files and they they are really used. Some containers might have a shared lib directory with a older versions of the required libraries. Check the log file. Each Hibernate product reports its version when starting up.</p> </div> </li> <li> <p>If you sure you are using the right version of Annotations and Search and you still get this exception it might be that you have a custom class loading configuration which prevents Annotations to locate the Search specific event listeners. If this is the case try the manual configuration.</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="how-do-i-get-started-with-the-search-archetype"><a class="anchor" href="#how-do-i-get-started-with-the-search-archetype"></a>How do I get started with the search archetype?</h3> <div class="paragraph"> <p>Use the following command, specifying the latest Hibernate Search version for archetypeVersion (or the version of your choice):</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code>mvn archetype:generate -DarchetypeGroupId=org.hibernate -DarchetypeArtifactId=hibernate-search-quickstart -DarchetypeVersion=4.0.0.Final -DarchetypeRepository=http://repository.jboss.org/nexus/content/groups/public-jboss/</code></pre> </div> </div> <div class="paragraph"> <p>You need to specify the group id, artifact id and a version. Once the sample project is created you can inspect the sources and run for exmaple mvn test.</p> </div> <div class="paragraph"> <p>To get a full list of available archetypes in the repo run:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code>mvn archetype:generate -DarchetypeRepository=http://repository.jboss.org/nexus/content/groups/public-jboss</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="integration"><a class="anchor" href="#integration"></a>Integration</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="code-nosuchmethoderror-code-in-jboss-as-4-2"><a class="anchor" href="#code-nosuchmethoderror-code-in-jboss-as-4-2"></a><code>NoSuchMethodError</code> in JBoss AS 4.2</h3> <div class="paragraph"> <p>The error is: <code>Caused by: java.lang.NoSuchMethodError: org.hibernate.search.FullTextSession.createFullTextQuery(Lorg/apache/lucene/search/Query;[Ljava/lang/Class;)Lorg/hibernate/search/FullTextQuery;</code></p> </div> <div class="paragraph"> <p>Hibernate Search 3.0 requires Hibernate Annotations 3.3.x and JBoss AS 4.2 ships with 3.2.x. Replace the following jars:</p> </div> <div class="ulist"> <ul> <li> <p>hibernate-annotations.jar (3.3.x for Search 3.0)</p> </li> <li> <p>hibernate-validator.jar (3.0.x for Search 3.0)</p> </li> <li> <p>hibernate-entitymanager.jar (3.3.x for Search 3.0)</p> </li> <li> <p>hibernate-commons-annotations.jar (3.0.x for Search 3.0)</p> </li> </ul> </div> <div class="paragraph"> <p>in <code>[JBOSS_HOME]/server/[myconfig]/lib</code>. Then place Hibernate Search and Lucene JARs in your EAR or WAR.</p> </div> </div> <div class="sect2"> <h3 id="i-am-using-spring-and-the-index-is-not-being-updated-at-transaction-commit"><a class="anchor" href="#i-am-using-spring-and-the-index-is-not-being-updated-at-transaction-commit"></a>I am using Spring and the index is not being updated at transaction commit</h3> <div class="paragraph"> <p>See also <a href="http://www.hibernate.org/441.html">spring integration</a> and especially check you&#8217;re using the correct transaction manager:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="xml language-xml"><span style="color:#070">&lt;bean</span> <span style="color:#b48">id</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">transactionManager</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">org.springframework.orm.jpa.JpaTransactionManager</span><span style="color:#710">&quot;</span></span><span style="color:#070">&gt;</span></code></pre> </div> </div> </div> <div class="sect2"> <h3 id="how-do-i-properly-shutdown-search"><a class="anchor" href="#how-do-i-properly-shutdown-search"></a>How do I properly shutdown Search?</h3> <div class="paragraph"> <p>Search is using background threads to manage the indexes; they are gracefully closed when you close Hibernate&#8217;s <code>SessionFactory</code>. Closing the <code>SessionFactory</code> is always recommended; when using Search it&#8217;s mandatory, otherwise your application might never terminate.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">sessionFactory.close();</code></pre> </div> </div> <div class="paragraph"> <p>When using <code>exclusive_index_use=true</code> it&#8217;s also needed to properly clear the index locks; note that this options is enabled by default since Hibernate Search 4.0.</p> </div> </div> </div> </div> </div> </div> </div> <footer class="container"> <div class="row-fluid"> <div class="span3 offset2"> <h4>Projects</h4> <ul> <li> <a href="../../orm" title="Hibernate ORM">Hibernate ORM</a> </li> <li> <a href=".." title="Search">Hibernate Search</a> </li> <li> <a href="../../validator" title="Hibernate Validator">Hibernate Validator</a> </li> <li> <a href="../../ogm" title="Hibernate OGM">Hibernate OGM</a> </li> <li> <a href="../../tools" title="Hibernate Tools">Hibernate Tools</a> </li> <li> <a href="../../others" title="Other projects">Other projects</a> </li> </ul> </div> <div class="span3"> <h4>Follow Us</h4> <ul> <li> <a href="http://in.relation.to" title="Blog">Blog</a> </li> <li> <a href="https://twitter.com/hibernate/" title="Twitter">Twitter</a> </li> <li> <a href="https://plus.google.com/112681342290762837955/posts" title="Google+">Google+</a> </li> </ul> </div> <div class="span3"> <h4>Contribute and community</h4> <ul> <li> <a href="../../community" title="Community resources">Community resources</a> </li> <li> <a href="https://hibernate.atlassian.net" title="Submit a bug">Submit a bug</a> </li> </ul> </div> </div> </footer> <div class="container" id="companyfooter"> <div class="row-fluid"> <div class="span6 redhatlogo text-center"> <div id="logospacer"></div> <a href="http://www.redhat.com/"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png"></a> </div> <div class="span6 redhatlogo text-center"> <div id="logospacer"></div> <a href="http://www.jboss.org/"> <img src="../../cache/static.jboss.org/theme/images/common/jbossbadge.png"> </a> </div> </div> </div> <span class="backToTop"> <a href="#top">back to top</a> </span> <script src="http://static.jboss.org/theme/js/libs/bootstrap-community/2.3.1.2/bootstrap-community.min.js"></script> <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount','UA-45270411-1']);
    _gaq.push(['_trackPageview']);
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script> </body> </html>